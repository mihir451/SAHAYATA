<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nearby Hospitals & Pharmacies</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: "Poppins", sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      background: url(istockphoto-1452316636-612x612.jpg);
      color: #333;
    }
    header {
      background: rgba(219, 73, 73, 0.9);
      color: #fff;
      padding: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 22px;
      font-weight: 600;
      letter-spacing: 1px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    header .title { display: flex; align-items: center; gap: 8px; }

    /* Rescue Alert Button */
    header .alert-btn {
      background: #ff0000;
      border: none;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      padding: 10px 16px;
      color: white;
      border-radius: 8px;
      animation: blink 1s infinite;
      transition: transform 0.2s;
    }
    header .alert-btn:hover { transform: scale(1.1); background: darkred; }

    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }

    /* Alert dropdown */
    #alertBox {
      display: none;
      position: absolute;
      top: 65px;
      right: 15px;
      background: #fff;
      color: #333;
      padding: 14px;
      border-radius: 10px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
      width: 270px;
      z-index: 10;
    }
    #alertBox h4 { margin-bottom: 8px; font-size: 16px; color: #d00000; }
    #alertBox p { font-size: 14px; margin-bottom: 6px; }

    #map {
      flex: 1;
      height: 55%;
      border-bottom: 2px solid #ddd;
      z-index: 0;
      border-radius: 12px;
      overflow: hidden;
      margin: 10px;
    }
    #controls {
      padding: 12px;
      background: rgba(255,255,255,0.9);
      display: flex;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      position: sticky;
      top: 0;
      z-index: 5;
      border-radius: 12px;
      margin: 8px;
    }
    #controls input {
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      min-width: 200px;
      transition: border 0.3s;
    }
    #controls input:focus { border: 1px solid #0077b6; outline: none; }

    #results {
      height: 35%;
      overflow-y: auto;
      padding: 14px;
      background: rgba(255,255,255,0.95);
      border-top: 1px solid #eee;
      border-radius: 12px;
      margin: 8px;
    }
    .result-item {
      background: #fff;
      padding: 14px;
      margin-bottom: 12px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
      border-left: 5px solid #0077b6;
    }
    .result-item:hover { transform: translateY(-4px); box-shadow: 0 6px 16px rgba(0,0,0,0.25); }
    .result-item h3 {
      font-size: 16px;
      margin-bottom: 6px;
      color: red;
    }
    .result-item h3 a {
      text-decoration: none;
      color: red;
      font-weight: bold;
    }
    .result-item h3 a:hover { text-decoration: underline; }
    .result-item p { font-size: 13px; margin: 3px 0; color: #444; }
    .result-item .btns { margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap; }

    button {
      padding: 7px 14px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.3s, transform 0.2s;
    }
    button:hover { transform: scale(1.05); }
    .locate-btn { background: #0077b6; color: white; }
    .search-btn { background: #00b4d8; color: white; }
    .show-btn { background: #2ecc71; color: white; }
    .dir-btn { background: #ff6b6b; color: white; }
  </style>
</head>
<body>
  <header>
    <div class="title">üè• Nearby Hospitals & Pharmacies</div>
    <button class="alert-btn" onclick="toggleAlert()">üö® Rescue Alert</button>
    <div id="alertBox">
      <h4>üö® Rescue Alerts</h4>
      <p>üìû Emergency Helpline: <b>108</b></p>
      <p>ü¶† COVID Testing Available Nearby</p>
      <p>üíâ Free Vaccination Camp this week</p>
    </div>
  </header>

  <div id="controls">
    <button class="locate-btn" onclick="locateMe()">üìç Use My Location</button>
    <input type="text" id="searchInput" placeholder="Enter Latitude,Longitude">
    <button class="search-btn" onclick="manualSearch()">üîç Search</button>
  </div>

  <div id="map"></div>
  <div id="results"><b>Results will appear here...</b></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    let map = L.map("map").setView([20.5937, 78.9629], 5); 
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 19 }).addTo(map);

    let markers = [];

    function clearMarkers() {
      markers.forEach(m => map.removeLayer(m));
      markers = [];
    }

    function haversine(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI/180) * Math.cos(lat2 * Math.PI/180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }

    function fetchHospitalsAndPharmacies(lat, lon) {
      clearMarkers();
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "<b>üîç Searching nearby hospitals & pharmacies...</b>";

      const overpassUrl = `
        https://overpass-api.de/api/interpreter?data=[out:json];
        (
          node["amenity"="hospital"](around:10000,${lat},${lon});
          node["amenity"="pharmacy"](around:10000,${lat},${lon});
        );
        out body;
      `;

      fetch(overpassUrl)
        .then(res => res.json())
        .then(data => {
          resultsDiv.innerHTML = "";
          if (!data.elements.length) {
            resultsDiv.innerHTML = "<b>No hospitals or pharmacies found nearby.</b>";
            return;
          }

          let enriched = data.elements.map(el => {
            const dist = haversine(lat, lon, el.lat, el.lon);
            return { ...el, distance: dist };
          }).sort((a, b) => a.distance - b.distance);

          enriched.forEach(el => {
            const name = el.tags.name || "Unnamed " + (el.tags.amenity === "hospital" ? "Hospital" : "Pharmacy");
            const type = el.tags.amenity;
            const latlng = [el.lat, el.lon];

            let addrParts = [];
            if (el.tags["addr:street"]) addrParts.push(el.tags["addr:street"]);
            if (el.tags["addr:city"]) addrParts.push(el.tags["addr:city"]);
            if (el.tags["addr:state"]) addrParts.push(el.tags["addr:state"]);
            if (el.tags["addr:postcode"]) addrParts.push(el.tags["addr:postcode"]);
            let address = addrParts.join(", ") || "Address not available";

            let color = type === "hospital" ? "red" : "green";
            let marker = L.circleMarker(latlng, { color, radius: 8 })
              .addTo(map)
              .bindPopup(`<b>${name}</b><br>${address}<br>üìè ${el.distance.toFixed(2)} km away`);
            markers.push(marker);

            const div = document.createElement("div");
            div.classList.add("result-item");
            div.innerHTML = `
              <h3><a href="https://www.google.com/maps/search/?api=1&query=${el.lat},${el.lon}" target="_blank">${name}</a></h3>
              <p>üè∑Ô∏è Type: ${type}</p>
              <p>üìç ${address}</p>
              <p>üìè ${el.distance.toFixed(2)} km away</p>
              <div class="btns">
                <button class="show-btn" onclick="map.setView([${el.lat}, ${el.lon}], 17)">Show on Map</button>
                <a href="https://www.google.com/maps/dir/?api=1&destination=${el.lat},${el.lon}" target="_blank">
                  <button class="dir-btn">Get Directions</button>
                </a>
              </div>
            `;
            resultsDiv.appendChild(div);
          });
        })
        .catch(err => {
          console.error(err);
          resultsDiv.innerHTML = "<b>‚ö†Ô∏è Error fetching data.</b>";
        });
    }

    function locateMe() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const { latitude, longitude } = pos.coords;
          map.setView([latitude, longitude], 15);
          L.marker([latitude, longitude]).addTo(map).bindPopup("üìç You are here").openPopup();
          fetchHospitalsAndPharmacies(latitude, longitude);
        });
      } else {
        alert("Geolocation not supported.");
      }
    }

    function manualSearch() {
      const val = document.getElementById("searchInput").value.trim();
      if (!val) return alert("Enter latitude,longitude");
      const [lat, lon] = val.split(",").map(Number);
      if (isNaN(lat) || isNaN(lon)) return alert("Invalid input");
      map.setView([lat, lon], 15);
      fetchHospitalsAndPharmacies(lat, lon);
    }

    // Toggle alerts
    function toggleAlert() {
      const box = document.getElementById("alertBox");
      box.style.display = box.style.display === "block" ? "none" : "block";
    }
  </script>
</body>
</html>
